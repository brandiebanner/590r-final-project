---
title: "Displacement Analysis"
author: "Brandie Shackelford"
format:
  html:
    theme: slate
execute:
  echo: false
  warning: false
  message: false
---

```{r}
library(ggplot2)
library(dplyr)
library(tidyr)
displaced <- readRDS(here::here("data", "refugees.rds"))
displaced <- displaced |> mutate(`Asylum Seekers` = asylum_seekers ,
										Refugees = refugees,
										IDPs = idps)
```

## Introduction to data

This is data on displacement between 2010 and 2022. The data is from UNHCR, UNRWA, and the IDMC, but I downloaded it from TidyTuesday.

*A quick brief on terminology:*

\-**Asylum seeker**: a person who has applied or attends to apply for refugee status.

\-**Refugee**: someone who has been forced to flee across an international border to seek safety (owing to well-founded fear of being persecuted for reasons of race, religion, nationality, membership of a particular social group or political opinion).

\-**Internally displaced person (IDP)**: a person displaced within their home country (for any reason, including disasters).

## Displacement over time

```{r}
year <- displaced |> group_by(year) |> summarise(Refugees = sum(refugees, na.rm = TRUE), `Asylum Seekers` = sum(asylum_seekers, na.rm = TRUE), IDPs = sum(idps, na.rm = TRUE))
# sum(displaced$refugees)
# sum(displaced$asylum_seekers)
# sum(displaced$idps)
# sum(year$refugees)
# sum(year$asylum)
# sum(year$idps)

long_totals <- year %>%
  pivot_longer(cols = c(Refugees, `Asylum Seekers`, IDPs),
               names_to = "type",
               values_to = "count")
```

The number of displaced people globally has increased substantially between 2010 and 2022 (@fig-time).

```{r}
#| label: fig-time
#| fig-cap: "Displacement Trends, 2010-2022"
ggplot(long_totals, aes(x = year, y = count, color = type)) +
  geom_line(size = 1) +
  labs(
    x = "Year",
    y = "Number of People",
    color = "Displacement Type"
  ) +
  scale_x_continuous(
  breaks = seq(min(long_totals$year), max(long_totals$year), by=2) )+  
  scale_y_continuous(labels = scales::comma) +             
  theme_minimal()
```

## Country of Origin and Asylum

@tbl-coo shows the regions refugees fled from between 2010 and 2022.

```{r}
library(gtsummary)
#| label: tbl-coo
#| tbl-cap: "Country of origin of refugees and IDPs"
tbl_summary(
  displaced,
  by = coo_region,
  include = c(Asylum_Seekers, Refugees))
```

## Regression
@tbl-regression shows the results of a regression that XYZ refugees fled from between 2010 and 2022.

```{r}
library(gtsummary)
#| label: tbl-regression
#| tbl-cap: "Country of origin of refugees and IDPs"
tbl_summary(
  displaced,
  by = coo_region,
  include = c(Asylum_Seekers, Refugees))
```
